Программа для написания ассемблер кода, который в дальшейшем будет использоваться на компьютере, построенным в факторио. Имеет встроенный компилятор и интерпритатор.  
[Посмотреть наработки факторио](Factorio.md)

# Компиляция
Каждая команда состоит из 2 байт + дополнительно выделенная память для аргументов.  
Информация о команде:
- 8 бит - команда (2^8 = 256 возможных команд)  
- 2 бит - тип команды  
- 3 бит - дополнительно выделенная память  
- 3 бит - пустые (возмона дальшейшая модификация команды)

Запись:
CCCCCCCC TTDDDPPP
- C - команла.
- T - тип команды.
- D - количество дополнительный байт.
- P - пустые биты.

# Интерпритация
Класс интерпритатора принимает на вход уже скомпилированные команды. Далее скомпилированные команды прогонятся через цикл и выполняются последовательно.  
1) Интерпритатор ищет команду, id которой равен первым 8 бит скомпилированной команды.
2) Через id происходит получение доступа к обработчику.
3) Затем выполняется обработка команды (запуск её метода).

# Регистры
1) A - арифметический регистр.
   Используется для арифметических операций, не реализующих полный функционал. Все арифметические операции, не указывающие на другой регистр, записывают резаультат в регистр A.
2) L - логический регистр.
   Используется для операция сравнения, не реализующих полный функционал. Все логические операции, не указывающие на другой регистр, записывают резаультат в регистр L.
3) J - регистр сравнений.
   Используется для операция сравнения, не реализующих полный функционал.
4) C - регистр цикла.  
   Используется командой loop, задаёд количество повторений, идёт с конца. Т.е 10 -> 9 -> 8 -> ... -> 0.
10) B0, B1, B2, B3, B4, B5, B6, B7 - дополнительные регистры  .
   Регистры используещиеся для временного хранения данных или использования.

### Регистры памяти
1) M - регистр памти.
   Используется для операция сравнения, не реализующих полный функционал. Операции для записии и чтения, не указывающие на другой регистр, записывают резаультат в регистр M.
2) H, K - регистры индекса оперативной памяти.
   H - старший байт.  
   K - младший байт.  
   Запись в двоичном формате: HHHHHHHH_KKKKKKKK

### Регистры стека
1) Sn1, Sn2 - регистры, указывающие на последний элемент в стеке.
   Sn1 - старший байт.
   Sn2 - младший байт.
2) Sc - конфиг стека.
   - 1-ый бит отвечает за направление стека: 0 - убывает, 1 - возрастает
   - остальные 8 - разбер стека, таким образом максимальный размер стека - 2<sup>7</sup> байт = 128 байт.
   
Ss1, Ss2 и Sc следует указывать к начале кода программы и вне основного цикла, если таковой имеется.  
Sn1 и Sn2 во время работы менять не рекомендуется, данные регистры управляются процессором.

# Команды

## Арифметика

### add
Id команды: 0.  
Выполняет сложение значений и сохраняет результат в регистр.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | A + const    | add 5         | 3 байта       |
| 1           | A + reg      | add B         | 3 байта       |
| 2           | reg + const  | add B, 5      | 4 байта       |
| 3           | reg + reg    | add B, C      | 4 байта       |

### sub
Id команды: 1.  
Выполняет вычитание значений и сохраняет результат в регистр.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | A - const    | sub 5         | 3 байта       |
| 1           | A - reg      | sub B         | 3 байта       |
| 2           | reg - const  | sub B, 5      | 4 байта       |
| 3           | reg - reg    | sub B, C      | 4 байта       |

### mul
Id команды: 2.  
Выполняет умножение значений и сохраняет результат в регистр.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | A * const    | mul 5         | 3 байта       |
| 1           | A * reg      | mul B         | 3 байта       |
| 2           | reg * const  | mul B, 5      | 4 байта       |
| 3           | reg * reg    | mul B, C      | 4 байта       |

### div
Id команды: 3.  
Выполняет операцию деления и сохраняет результат в регистр.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | A / const    | div 5         | 3 байта       |
| 1           | A / reg      | div B         | 3 байта       |
| 2           | reg / const  | div B, 5      | 4 байта       |
| 3           | reg / reg    | div B, C      | 4 байта       |

### inc
Id команды: 4.  
Увеличивает значение регистра на 1.
| Тип команды | Тип операции | Пример записи  | Размер (байт) |
|-------------|--------------|----------------|-------------- |
| 0           | A + 1        | inc            | 2 байта       |
| 1           | reg + 1      | inc B          | 3 байта       |

### dec
Id команды: 5.  
Уменьшает значение регистра на 1.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | A - 1        | dec           | 2 байта       |
| 1           | reg - 1      | dec B         | 3 байта       |

## Логика

### and
Id команды: 6.  
Выполняет побитовое «И» двух операндов и сохраняет результат в регистр.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | L & const    | and 5         | 3 байта       |
| 1           | L & reg      | and B         | 3 байта       |
| 2           | reg & const  | and B, 5      | 4 байта       |
| 3           | reg & reg    | and B, C      | 4 байта       |

### or
Id команды: 7.  
Выполняет побитовое «ИЛИ» двух операндов и сохраняет результат в регистр.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | L \| const   | or 5          | 3 байта       |
| 1           | L \| reg     | or B          | 3 байта       |
| 2           | reg \| const | or B, 5       | 4 байта       |
| 3           | reg \| reg   | or B, C       | 4 байта       |

### xor
Id команды: 8.  
Выполняет побитовое «Исключающее ИЛИ» двух операндов и сохраняет результат в регистр.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | L ^ const    | xor 5         | 3 байта       |
| 1           | L ^ reg      | xor B         | 3 байта       |
| 2           | reg ^ const  | xor B, 5      | 4 байта       |
| 3           | reg ^ reg    | xor B, C      | 4 байта       |

### not
Id команды: 8.  
Выполняет побитовое отрицание (инверсию) операнда и сохраняет результат в регистр.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | ~L           | not           | 2 байта       |
| 1           | ~reg         | not B         | 3 байта       |

## Память
### mov
Id команды: 10.  
Копирует значение из одного регистра или константы в другой регистр.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | reg <- const | mov A, 5      | 2 байта       |
| 1           | reg <- reg   | mov A, B      | 2 байта       |

### load
Id команды: 11. 
Загружает значение из ячейки памяти в регистр.
| Тип команды | Тип операции              | Пример записи                   | Размер (байт) |
|-------------|---------------------------|---------------------------------|-------------- |
| 0           | M <- RAM\[H_K\]           | load                            | 2 байта       |
| 1           | M <- RAM\[const_const\]   | load 0b00000000, 0b10000011     | 4 байта       |
| 2           | reg <- RAM\[H_K\]         | load B                          | 3 байта       |
| 3           | reg <- RAM\[const_const\] | load B, 0b00000000, 0b10000011  | 5 байт        |

### store
Id команды: 12.  
Сохраняет значение из регистра в ячейку памяти.
| Тип команды | Тип операции              | Пример записи                    | Размер (байт) |
|-------------|---------------------------|----------------------------------|-------------- |
| 0           | RAM\[H_K\] <- M           | store                            | 2 байта       |
| 1           | RAM\[const_const\] <- M   | store 0b00000000, 0b10000011     | 4 байта       |
| 2           | RAM\[H_K\] <- reg         | store B                          | 3 байта       |
| 3           | RAM\[const_const\] <- reg | store B,  0b00000000, 0b10000011 | 5 байта       |

## Переходы
### jmp
Id команды: 13.  
Безусловно переходит на адрес указанной метки.
| Тип команды | Тип операции | Пример записи | Размер (байт) |
|-------------|--------------|---------------|-------------- |
| 0           | jmp -> metka | jmp b         | 2 байта       |

### je
Id команды: 14.  
Переходит на метку, если два операнда **равны**.
| Тип команды | Тип операции              | Пример записи  | Размер (байт) |
|-------------|---------------------------|----------------|-------------- |
| 0           | J == const -> jmp metka   | je 5, metka    | 5 байт        |
| 1           | J == reg -> jmp metka     | je B, metka    | 5 байт        |
| 2           | reg == const -> jmp metka | je B, 5, metka | 6 байт        |
| 3           | reg == reg -> jmp metka   | je B, C, metka | 6 байт        |

### jne
Id команды: 15.  
Переходит на метку, если два операнда **не равны**.
| Тип команды | Тип операции              | Пример записи   | Размер (байт) |
|-------------|---------------------------|-----------------|-------------- |
| 0           | J != const -> jmp metka   | jne 5, metka    | 5 байт        |
| 1           | J != reg -> jmp metka     | jne B, metka    | 5 байт        |
| 2           | reg != const -> jmp metka | jne B, 5, metka | 6 байт        |
| 3           | reg != reg -> jmp metka   | jen B, C, metka | 6 байт        |

### jg
Id команды: 16.  
Переходит на метку, если первый операнд **больше второго**.
| Тип команды | Тип операции             | Пример записи  | Размер (байт) |
|-------------|--------------------------|----------------|-------------- |
| 0           | J > const -> jmp metka   | jg 5, metka    | 5 байт        |
| 1           | J > reg -> jmp metka     | jg B, metka    | 5 байт        |
| 2           | reg > const -> jmp metka | jg B, 5, metka | 6 байт        |
| 3           | reg > reg -> jmp metka   | jg B, C, metka | 6 байт        |

### jl
Id команды: 17.  
Переходит на метку, если первый операнд **меньше** второго.
| Тип команды | Тип операции             | Пример записи  | Размер (байт) |
|-------------|--------------------------|----------------|-------------- |
| 0           | J < const -> jmp metka   | jg 5, metka    | 5 байт        |
| 1           | J < reg -> jmp metka     | jg B, metka    | 5 байт        |
| 2           | reg < const -> jmp metka | jg B, 5, metka | 6 байт        |
| 3           | reg < reg -> jmp metka   | jg B, C, metka | 6 байт        |

### jge
Id команды: 18.  
Переходит на метку, если первый операнд **больше или равен** второму.
| Тип команды | Тип операции              | Пример записи   | Размер (байт) |
|-------------|---------------------------|-----------------|-------------- |
| 0           | J >= const -> jmp metka   | jge 5, metka    | 5 байт        |
| 1           | J >= reg -> jmp metka     | jge B, metka    | 5 байт        |
| 2           | reg >= const -> jmp metka | jge B, 5, metka | 6 байт        |
| 3           | reg >= reg -> jmp metka   | jge B, C, metka | 6 байт        |

### jle
Id команды: 19.  
Переходит на метку, если первый операнд **меньше или равен** второму.
| Тип команды | Тип операции              | Пример записи   | Размер (байт) |
|-------------|---------------------------|-----------------|-------------- |
| 0           | J <= const -> jmp metka   | jle 5, metka    | 5 байт        |
| 1           | J <= reg -> jmp metka     | jle B, metka    | 5 байт        |
| 2           | reg <= const -> jmp metka | jle B, 5, metka | 6 байт        |
| 3           | reg <= reg -> jmp metka   | jle B, C, metka | 6 байт        |

### loop
Id команды: 20.  
Уменьшает регистр C на 1; если C ≠ 0, переходит на указанную метку.
| Тип команды | Тип операции                 | Пример записи   | Размер (байт) |
|-------------|------------------------------|-----------------|-------------- |
| 0           | C - 1 -> C != 0 -> jmp metka | loop metka      | 4 байта       |

# Примеры

## Арифметика
```asm
add 5          // A = A + 5
add B          // A = A + B
add B, 5       // B = B + 5
add B, C       // B = B + C

sub 5          // A = A - 5
sub B          // A = A + B
sub B, 5       // B = B + 5
sub B, C       // B = B + C

mul 5          // A = A * 5
mul B          // A = A * B
mul B, 5       // B = B * 5
mul B, C       // B = B * C

div 5          // A = A / 5
div B          // A = A / B
div B, 5       // B = B / 5
div B, C       // B = B / C

inc            // A = A + 1
inc B          // B = B + 1

dec            // A = A - 1
dec B          // B = B - 1
``` 

## Логика
```asm
not       // L = ~L
not B     // B = ~B

and 5     // L = L & 5
or B      // L = L | B
xor C     // L = L ^ C

// Аналогично с арифметическими операциями, можно указать регистр
// в качестве первого аргумента.
```

## Память
```asm
mov A, B                           // A = B
mov A, 5                           // A = 5

load                               // M = storage\[H_K\]
load 0b00000000, 0b00000001        // M = storage\[const_const\]
load B                             // B = storage\[H_K\]
load B, 0b00000000, 0b00000001     // B = storage\[const_const\]

store                            // storage\[H_K\] = M
store 0b00000000, 0b00000001     // storage\[const_const\] = M
store B                          // storage\[H_K\] = B
store B, 0b00000000, 0b00000001  // storage\[const_const\] = B
```

## Переходы
```asm
jmp end

je 5, end          // J == 5 -> jmp end
je B, end          // J == B -> jmp end
je B, 5, end       // B == 5 -> jmp end
je B, C, end       // B == C -> jmp end

// Абсольтно такие же пораметры можно
// использовать для следующих команд:
jne 5, end
jg B, end
jge B, 5, end
jl B, C, end
jle A, 0, end

end:           // Метка
```

## Циклы
```asm
mov C, 10

loop1:

// Do something
// Цикл повториться 10 раз

loop loop1
```
